<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loguru Viewer</title>
    <meta name="description" content="Loguru Viewer lets you drop in JSONL or text log files, browse entries quickly, filter by level, and switch between light and dark themes.">
    <meta name="keywords" content="Loguru, log viewer, JSONL logs, log filtering, debugging, log analysis tool">
    <meta name="author" content="Yehor Smoliakov">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="./logviewer.html">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Loguru Viewer | Interactive Log Explorer">
    <meta property="og:description" content="Drag and drop JSONL or text logs, filter by severity, search entries, and review history with an adaptive UI.">
    <meta property="og:url" content="./logviewer.html">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Loguru Viewer | Interactive Log Explorer">
    <meta name="twitter:description" content="Inspect Loguru output with fast filtering, search, and dark/light modes.">
    <style>
        :root {
            --bg-primary: #f9fafb;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f8fafc;
            --bg-gray-50: #f9fafb;
            --bg-gray-100: #f3f4f6;
            --bg-gray-200: #e5e7eb;
            --text-primary: #1f2937;
            --text-secondary: #374151;
            --text-tertiary: #4b5563;
            --text-muted: #6b7280;
            --border-color: #d1d5db;
            --border-light: #e5e7eb;
            --border-card: #e2e8f0;
            --hover-bg: #f7fafc;
            --drop-zone-border: #cbd5e0;
            --drop-zone-hover-bg: #ebf8ff;
            --drop-zone-hover-border: #4299e1;
            --stat-card-bg: #f8fafc;
            --modal-bg: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --bg-tertiary: #1f2937;
            --bg-gray-50: #111827;
            --bg-gray-100: #1f2937;
            --bg-gray-200: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #e5e7eb;
            --text-tertiary: #d1d5db;
            --text-muted: #9ca3af;
            --border-color: #4b5563;
            --border-light: #374151;
            --border-card: #4b5563;
            --hover-bg: #374151;
            --drop-zone-border: #4b5563;
            --drop-zone-hover-bg: #1e3a5f;
            --drop-zone-hover-border: #3b82f6;
            --stat-card-bg: #1f2937;
            --modal-bg: #1f2937;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--bg-primary);
            min-height: 100vh;
            transition: background-color 0.3s ease;
        }
        .container { max-width: 1280px; margin: 0 auto; padding: 0 1rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        
        /* Mobile Responsive Adjustments */
        @media (max-width: 768px) {
            .container { padding: 0 0.75rem; }
            .py-8 { padding-top: 1rem; padding-bottom: 1rem; }
            .px-4 { padding-left: 0.75rem; padding-right: 0.75rem; }
        }
        .mb-8 { margin-bottom: 2rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .ml-1 { margin-left: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        
        @media (max-width: 640px) {
            .mb-8 { margin-bottom: 1rem; }
            .mb-6 { margin-bottom: 0.75rem; }
        }
        .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .text-xs { font-size: 0.75rem; line-height: 1rem; }
        .text-6xl { font-size: 3.75rem; line-height: 1; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        
        @media (max-width: 640px) {
            .text-4xl { font-size: 1.75rem; line-height: 2rem; }
            .text-6xl { font-size: 2.5rem; line-height: 1; }
            .text-2xl { font-size: 1.25rem; line-height: 1.75rem; }
            .text-xl { font-size: 1.125rem; line-height: 1.5rem; }
        }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .text-gray-800 { color: var(--text-primary); }
        .text-gray-700 { color: var(--text-secondary); }
        .text-gray-600 { color: var(--text-tertiary); }
        .text-gray-500 { color: var(--text-muted); }
        .text-white { color: #ffffff; }
        .bg-white { background-color: var(--bg-secondary); }
        .bg-gray-50 { background-color: var(--bg-gray-50); }
        .bg-gray-100 { background-color: var(--bg-gray-100); }
        .bg-gray-200 { background-color: var(--bg-gray-200); }
        .bg-red-500 { background-color: #ef4444; }
        .bg-green-500 { background-color: #10b981; }
        .hover\:bg-red-600:hover { background-color: #dc2626; }
        .hover\:bg-green-600:hover { background-color: #059669; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-full { border-radius: 9999px; }
        .p-12 { padding: 3rem; }
        .p-8 { padding: 2rem; }
        .p-6 { padding: 1.5rem; }
        .p-4 { padding: 1rem; }
        
        @media (max-width: 640px) {
            .p-12 { padding: 1.5rem; }
            .p-8 { padding: 1rem; }
            .p-6 { padding: 0.75rem; }
        }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-0\.5 { padding-top: 0.125rem; padding-bottom: 0.125rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .shadow { box-shadow: 0 1px 3px 0 var(--shadow-color), 0 1px 2px -1px var(--shadow-color); }
        .text-center { text-align: center; }
        .flex { display: flex; }
        .flex-wrap { flex-wrap: wrap; }
        .flex-1 { flex: 1 1 0%; }
        .grid { display: grid; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-3 { gap: 0.75rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .hidden { display: none; }
        .w-full { width: 100%; }
        .max-w-3xl { max-width: 48rem; }
        .max-w-4xl { max-width: 56rem; }
        .max-h-\[80vh\] { max-height: 80vh; }
        
        @media (max-width: 768px) {
            .max-w-3xl,
            .max-w-4xl {
                max-width: 95vw;
            }
        }
        .overflow-hidden { overflow: hidden; }
        .overflow-auto { overflow: auto; }
        .overflow-x-auto { overflow-x: auto; }
        .whitespace-nowrap { white-space: nowrap; }
        .border { border-width: 1px; }
        .border-b { border-bottom-width: 1px; }
        .border-b-2 { border-bottom-width: 2px; }
        .border-gray-300 { border-color: var(--border-color); }
        .border-gray-200 { border-color: var(--border-light); }
        .divide-y > * + * { border-top-width: 1px; }
        .divide-gray-200 > * + * { border-color: var(--border-light); }
        .uppercase { text-transform: uppercase; }
        .tracking-wider { letter-spacing: 0.05em; }
        table { border-collapse: collapse; width: 100%; }
        .text-left { text-align: left; }
        
        /* Responsive table */
        @media (max-width: 768px) {
            table th,
            table td {
                padding: 0.5rem !important;
                font-size: 0.8125rem;
            }
            table th {
                font-size: 0.75rem;
            }
        }
        
        @media (max-width: 640px) {
            /* Hide less critical columns on mobile */
            table th:nth-child(3),
            table td:nth-child(3),
            table th:nth-child(4),
            table td:nth-child(4),
            table th:nth-child(5),
            table td:nth-child(5) {
                display: none;
            }
            table th,
            table td {
                padding: 0.4rem !important;
                font-size: 0.75rem;
            }
        }
        .inset-0 { inset: 0px; }
        .fixed { position: fixed; }
        .z-50 { z-index: 50; }
        .bg-black { background-color: #000000; }
        .bg-opacity-50 { --tw-bg-opacity: 0.5; }
        button { cursor: pointer; border: none; }
        input[type="text"], input[type="file"] {
            font-size: 1rem;
            outline: none;
        }
        
        @media (max-width: 640px) {
            button {
                font-size: 0.875rem;
            }
            input[type="text"] {
                font-size: 0.875rem;
            }
        }
        input[type="text"]:focus, textarea:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        textarea {
            font-size: 0.95rem;
            resize: vertical;
        }
        .transition { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        pre { overflow-x: auto; }
        
        /* Responsive controls section */
        @media (max-width: 1024px) {
            .controls-wrapper {
                flex-direction: column;
            }
            .controls-wrapper > * {
                width: 100%;
            }
        }
        
        @media (max-width: 640px) {
            .button-group {
                flex-direction: column;
                gap: 0.5rem;
            }
            .button-group button {
                width: 100%;
                white-space: normal;
            }
        }
    </style>
    <style>
        .drop-zone {
            border: 3px dashed var(--drop-zone-border);
            transition: all 0.3s ease;
        }
        .drop-zone.drag-over {
            border-color: var(--drop-zone-hover-border);
            background-color: var(--drop-zone-hover-bg);
        }
        .log-row {
            transition: background-color 0.2s ease;
        }
        .log-row:hover {
            background-color: var(--hover-bg);
        }
        /* Default (light mode) log level colors */
        .level-DEBUG { color: #805ad5; }
        .level-INFO { color: #3182ce; }
        .level-WARNING { color: #d69e2e; }
        .level-ERROR { color: #e53e3e; }
        .level-CRITICAL { color: #c53030; }
        .level-SUCCESS { color: #38a169; }
        
        /* Dark mode log level colors */
        [data-theme="dark"] .level-DEBUG { color: #a78bfa; }
        [data-theme="dark"] .level-INFO { color: #60a5fa; }
        [data-theme="dark"] .level-WARNING { color: #fbbf24; }
        [data-theme="dark"] .level-ERROR { color: #f87171; }
        [data-theme="dark"] .level-CRITICAL { color: #ef4444; }
        [data-theme="dark"] .level-SUCCESS { color: #4ade80; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
        }
        
        @media (max-width: 640px) {
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 0.75rem;
            }
        }
        .stat-card {
            background-color: var(--stat-card-bg);
            border: 1px solid var(--border-card);
            border-radius: 0.75rem;
            padding: 1rem;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .stat-label {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }
        .stat-value {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        @media (max-width: 640px) {
            .stat-label {
                font-size: 0.75rem;
            }
            .stat-value {
                font-size: 0.95rem;
            }
        }
        .theme-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 100;
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 9999px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 6px var(--shadow-color);
            transition: all 0.3s ease;
            font-size: 1.25rem;
        }
        .theme-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 8px var(--shadow-color);
        }
        
        @media (max-width: 640px) {
            .theme-toggle {
                top: 0.5rem;
                right: 0.5rem;
                padding: 0.4rem 0.8rem;
                font-size: 1rem;
                gap: 0.3rem;
            }
        }
        .history-badge {
            background-color: #3b82f6;
            color: white;
            border-radius: 9999px;
            padding: 0.1rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 700;
            margin-left: 0.5rem;
        }
        
        @media (max-width: 640px) {
            .history-badge {
                font-size: 0.65rem;
                padding: 0.05rem 0.4rem;
            }
        }
        .modal-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-light);
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }
        .modal-btn:hover {
            background-color: var(--hover-bg);
            border-color: var(--border-color);
        }
        .modal-btn-primary {
            background-color: #3182ce;
            border-color: #3182ce;
            color: #ffffff;
        }
        .modal-btn-primary:hover {
            background-color: #2563eb;
            border-color: #2563eb;
            color: #ffffff;
        }
        .modal-btn-danger {
            background-color: #ef4444;
            border-color: #ef4444;
            color: #ffffff;
        }
        .modal-btn-danger:hover {
            background-color: #dc2626;
            border-color: #dc2626;
            color: #ffffff;
        }
        .modal-icon-btn {
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            background-color: transparent;
            color: var(--text-muted);
            transition: all 0.2s ease;
        }
        .modal-icon-btn:hover {
            color: var(--text-primary);
            background-color: var(--hover-bg);
        }
        .go-to-top-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 90;
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 9999px;
            padding: 0.75rem 1rem;
            cursor: pointer;
            display: none;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 6px var(--shadow-color);
            transition: all 0.3s ease;
            font-size: 1rem;
            color: var(--text-primary);
        }
        .go-to-top-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px var(--shadow-color);
            background-color: var(--hover-bg);
        }
        .go-to-top-btn.visible {
            display: flex;
        }
        
        @media (max-width: 640px) {
            .go-to-top-btn {
                bottom: 1rem;
                right: 1rem;
                padding: 0.6rem 0.8rem;
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Theme Toggle Button -->
    <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode">
        <span id="themeIcon">üåô</span>
    </button>

    <!-- Go to Top Button -->
    <button id="goToTopBtn" class="go-to-top-btn" aria-label="Go to top">
        <span>‚Üë</span>
        <span>Top</span>
    </button>

    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="mb-8 flex flex-wrap items-center justify-between gap-4">
            <div>
                <h1 class="text-4xl font-bold text-gray-800 mb-2">ü§ñ Loguru Viewer</h1>
                <p class="text-gray-600">Drag and drop a JSONL or text log file to view and filter logs</p>
            </div>
            <button id="historyBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition flex items-center gap-2">
                üïë History <span id="historyCount" class="history-badge hidden">0</span>
            </button>
        </div>

        <!-- Drop Zone -->
        <div id="dropZone" class="drop-zone bg-white rounded-lg p-12 mb-6 text-center">
            <div class="text-6xl mb-4">üìÅ</div>
            <p class="text-xl text-gray-700 mb-2">Drag & Drop Log File Here</p>
            <p class="text-sm text-gray-500">or click to browse</p>
            <input type="file" id="fileInput" accept=".json,.jsonl,.txt,.log" class="hidden">
        </div>

        <!-- Paste Logs -->
        <div class="bg-white rounded-lg p-6 mb-6 shadow">
            <div class="flex items-center justify-between mb-3">
                <div>
                    <p class="text-lg font-semibold text-gray-800">üìé Paste Logs</p>
                    <p class="text-sm text-gray-500">Paste JSONL or plain text logs and load them directly</p>
                </div>
                <button id="loadPasteBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition">
                    Load Pasted Logs
                </button>
            </div>
            <textarea id="pasteInput" class="w-full border border-gray-300 rounded-lg p-3 text-sm text-gray-800 bg-gray-50" rows="6" placeholder="Paste logs here..."></textarea>
            <p class="text-xs text-gray-500 mt-2">Tip: Press Ctrl/Cmd + Enter to load pasted content.</p>
        </div>

        <!-- File Info -->
        <div id="fileInfo" class="hidden bg-white rounded-lg p-4 mb-6 shadow">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-600">File:</p>
                    <p class="font-semibold text-gray-800" id="fileName"></p>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Total Logs:</p>
                    <p class="font-semibold text-gray-800" id="totalLogs"></p>
                </div>
                <button id="clearBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition">
                    Clear
                </button>
            </div>
        </div>

        <!-- Execution Stats -->
        <div id="statsSection" class="hidden bg-white rounded-lg p-6 mb-6 shadow">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">‚è±Ô∏è Execution Time</h2>
                <span class="text-sm text-gray-500" id="statsSourceNote"></span>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <p class="stat-label">Start Time</p>
                    <p class="stat-value" id="statStartTime">N/A</p>
                </div>
                <div class="stat-card">
                    <p class="stat-label">End Time</p>
                    <p class="stat-value" id="statEndTime">N/A</p>
                </div>
                <div class="stat-card">
                    <p class="stat-label">Total Duration</p>
                    <p class="stat-value" id="statTotalDuration">N/A</p>
                </div>
                <div class="stat-card">
                    <p class="stat-label">Max Elapsed</p>
                    <p class="stat-value" id="statMaxElapsed">N/A</p>
                </div>
                <div class="stat-card">
                    <p class="stat-label">Avg Gap Between Logs</p>
                    <p class="stat-value" id="statAvgGap">N/A</p>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div id="filterSection" class="hidden bg-white rounded-lg p-6 mb-6 shadow">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">üîç Filters</h2>
            <div class="flex flex-wrap gap-3 mb-4">
                <button class="filter-btn active" data-level="ALL">
                    All <span class="count ml-1 bg-gray-200 px-2 py-0.5 rounded-full text-sm">0</span>
                </button>
                <button class="filter-btn" data-level="DEBUG">
                    üêû Debug <span class="count ml-1 bg-gray-200 px-2 py-0.5 rounded-full text-sm">0</span>
                </button>
                <button class="filter-btn" data-level="INFO">
                    ‚ÑπÔ∏è Info <span class="count ml-1 bg-gray-200 px-2 py-0.5 rounded-full text-sm">0</span>
                </button>
                <button class="filter-btn" data-level="SUCCESS">
                    ‚úÖ Success <span class="count ml-1 bg-gray-200 px-2 py-0.5 rounded-full text-sm">0</span>
                </button>
                <button class="filter-btn" data-level="WARNING">
                    ‚ö†Ô∏è Warning <span class="count ml-1 bg-gray-200 px-2 py-0.5 rounded-full text-sm">0</span>
                </button>
                <button class="filter-btn" data-level="ERROR">
                    ‚ùå Error <span class="count ml-1 bg-gray-200 px-2 py-0.5 rounded-full text-sm">0</span>
                </button>
                <button class="filter-btn" data-level="CRITICAL">
                    üî• Critical <span class="count ml-1 bg-gray-200 px-2 py-0.5 rounded-full text-sm">0</span>
                </button>
            </div>
            <div class="flex flex-wrap items-center gap-3 controls-wrapper">
                <input type="text" id="searchInput" placeholder="Search logs..." 
                    class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" style="min-width: 200px;">
                <div class="flex flex-wrap gap-2 button-group">
                    <button id="sortToggle" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition whitespace-nowrap">
                        Sort by Time: Oldest ‚Üë
                    </button>
                    <button id="exportBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition whitespace-nowrap">
                        Export Filtered
                    </button>
                    <button id="copyModeToggle" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition whitespace-nowrap">
                        Copy &amp; Paste Mode
                    </button>
                </div>
            </div>
        </div>

        <div id="copyPanel" class="hidden bg-white rounded-lg p-4 mb-6 shadow">
            <div class="flex items-center justify-between mb-3">
                <div>
                    <p class="text-lg font-semibold text-gray-800">üìã Copy &amp; Paste Mode</p>
                    <p class="text-sm text-gray-500">Current filtered logs as plain text for easy copy/paste</p>
                </div>
                <button id="closeCopyMode" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-1 rounded-lg transition">
                    Close
                </button>
            </div>
            <textarea id="copyTextArea" class="w-full border border-gray-300 rounded-lg p-3 text-sm font-mono text-gray-800 bg-gray-50" rows="10" readonly></textarea>
        </div>

        <!-- Log Table -->
        <div id="logTableContainer" class="hidden bg-white rounded-lg shadow overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-100 border-b-2 border-gray-200">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Time</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Level</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Module</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Function</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Line</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Message</th>
                        </tr>
                    </thead>
                    <tbody id="logTableBody" class="divide-y divide-gray-200">
                    </tbody>
                </table>
            </div>
            <div id="noResults" class="hidden p-8 text-center text-gray-500">
                <p class="text-lg">No logs match the current filter</p>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="rounded-lg max-w-3xl w-full overflow-hidden shadow" style="background-color: var(--modal-bg); border: 1px solid var(--border-light);">
            <div class="p-4 border-b flex justify-between items-center" style="border-color: var(--border-light);">
                <div>
                    <h3 class="text-lg font-semibold" style="color: var(--text-primary);">Saved Log Sessions</h3>
                    <p class="text-sm" style="color: var(--text-muted);">Click an entry to reload logs saved from uploads or pastes.</p>
                </div>
                <div class="flex items-center gap-2">
                    <button id="clearHistoryBtn" class="modal-btn modal-btn-danger text-sm">Clear</button>
                    <button id="closeHistoryBtn" class="modal-icon-btn text-2xl">&times;</button>
                </div>
            </div>
            <div id="historyList" class="p-4 overflow-auto" style="color: var(--text-primary); max-height: 70vh;">
                <p class="text-sm" style="color: var(--text-muted);">No saved sessions yet. Open a log file or paste logs to save them here.</p>
            </div>
        </div>
    </div>

    <script>
        // Theme Management
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        
        // Check for saved theme preference or default to 'light'
        let currentTheme = 'light';
        try {
            currentTheme = localStorage.getItem('theme') || 'light';
        } catch (e) {
            console.warn('localStorage is not available, using default theme:', e);
        }
        document.documentElement.setAttribute('data-theme', currentTheme);
        updateThemeIcon(currentTheme);

        function updateThemeIcon(theme) {
            themeIcon.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            try {
                localStorage.setItem('theme', newTheme);
            } catch (e) {
                console.warn('Could not save theme preference to localStorage:', e);
            }
            updateThemeIcon(newTheme);
        });

        // Go to Top Button
        const goToTopBtn = document.getElementById('goToTopBtn');
        
        goToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
        
        // Show/hide "Go to Top" button based on scroll position
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                goToTopBtn.classList.add('visible');
            } else {
                goToTopBtn.classList.remove('visible');
            }
        });

        // Log Viewer Variables
        let allLogs = [];
        let filteredLogs = [];
        let currentFilter = 'ALL';
        let searchTerm = '';

        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const filterSection = document.getElementById('filterSection');
        const logTableContainer = document.getElementById('logTableContainer');
        const logTableBody = document.getElementById('logTableBody');
        const noResults = document.getElementById('noResults');
        const fileName = document.getElementById('fileName');
        const totalLogs = document.getElementById('totalLogs');
        const statsSection = document.getElementById('statsSection');
        const statsSourceNote = document.getElementById('statsSourceNote');
        const statStartTime = document.getElementById('statStartTime');
        const statEndTime = document.getElementById('statEndTime');
        const statTotalDuration = document.getElementById('statTotalDuration');
        const statMaxElapsed = document.getElementById('statMaxElapsed');
        const statAvgGap = document.getElementById('statAvgGap');
        const clearBtn = document.getElementById('clearBtn');
        const searchInput = document.getElementById('searchInput');
        const sortToggle = document.getElementById('sortToggle');
        const exportBtn = document.getElementById('exportBtn');
        const copyModeToggle = document.getElementById('copyModeToggle');
        const copyPanel = document.getElementById('copyPanel');
        const copyTextArea = document.getElementById('copyTextArea');
        const closeCopyMode = document.getElementById('closeCopyMode');
        const pasteInput = document.getElementById('pasteInput');
        const loadPasteBtn = document.getElementById('loadPasteBtn');
        const historyBtn = document.getElementById('historyBtn');
        const historyModal = document.getElementById('historyModal');
        const historyList = document.getElementById('historyList');
        const closeHistoryBtn = document.getElementById('closeHistoryBtn');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const historyCount = document.getElementById('historyCount');
        const HISTORY_KEY = 'logViewerHistory';
        const HISTORY_LIMIT = 15;
        let historyEntries = loadHistoryFromStorage();
        let copyModeEnabled = false;
        let sortDirection = 'asc';

        // Drag and drop handlers
        dropZone.addEventListener('click', () => fileInput.click());
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('drag-over');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file) handleFile(file);
        });
        
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) handleFile(file);
        });

        // Paste logs
        loadPasteBtn.addEventListener('click', () => loadPastedLogs());
        pasteInput.addEventListener('keydown', (e) => {
            if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
                e.preventDefault();
                loadPastedLogs();
            }
        });

        // Clear button
        clearBtn.addEventListener('click', () => {
            allLogs = [];
            filteredLogs = [];
            currentFilter = 'ALL';
            searchTerm = '';
            fileInput.value = '';
            searchInput.value = '';
            pasteInput.value = '';
            fileInfo.classList.add('hidden');
            filterSection.classList.add('hidden');
            logTableContainer.classList.add('hidden');
            statsSection.classList.add('hidden');
            dropZone.classList.remove('hidden');
            goToTopBtn.classList.remove('visible');
            setCopyMode(false);
        });

        // Search input
        searchInput.addEventListener('input', (e) => {
            searchTerm = e.target.value.toLowerCase();
            applyFilters();
        });

        // Sort toggle
        updateSortToggleLabel();
        sortToggle.addEventListener('click', () => {
            sortDirection = sortDirection === 'desc' ? 'asc' : 'desc';
            updateSortToggleLabel();
            applyFilters();
        });

        // Export button
        exportBtn.addEventListener('click', () => {
            const data = filteredLogs.map(log => JSON.stringify(log)).join('\n');
            const blob = new Blob([data], { type: 'application/jsonl' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const dateStr = new Date().toISOString().split('T')[0];
            a.href = url;
            a.download = `filtered_logs_${currentFilter}_${dateStr}.jsonl`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Copy & Paste mode
        copyModeToggle.addEventListener('click', () => {
            setCopyMode(!copyModeEnabled);
        });

        closeCopyMode.addEventListener('click', () => {
            setCopyMode(false);
        });

        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.getAttribute('data-level');
                applyFilters();
            });
        });
        
        // History modal
        updateHistoryBadge();
        historyBtn.addEventListener('click', () => {
            renderHistoryList();
            historyModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        });
        closeHistoryBtn.addEventListener('click', closeHistoryModal);
        historyModal.addEventListener('click', (e) => {
            if (e.target === historyModal) {
                closeHistoryModal();
            }
        });
        clearHistoryBtn.addEventListener('click', () => {
            historyEntries = [];
            persistHistory();
            renderHistoryList();
        });

        function showLoadedState(label) {
            fileName.textContent = label;
            dropZone.classList.add('hidden');
            fileInfo.classList.remove('hidden');
            filterSection.classList.remove('hidden');
            logTableContainer.classList.remove('hidden');
            goToTopBtn.classList.add('visible');
        }

        function handleFile(file) {
            const reader = new FileReader();
            
            reader.onload = (e) => {
                try {
                    const result = parseContent(e.target.result);
                    showLoadedState(file.name);
                    addHistoryEntry(file.name, e.target.result, result?.logsCount);
                } catch (error) {
                    showError('Error parsing log file: ' + error.message);
                }
            };
            
            reader.readAsText(file);
        }
        
        function loadPastedLogs() {
            const content = pasteInput.value.trim();
            if (!content) {
                showError('Please paste logs before loading.');
                return;
            }
            try {
                const result = parseContent(content);
                showLoadedState('Pasted logs');
                addHistoryEntry('Pasted logs', content, result?.logsCount);
            } catch (error) {
                showError('Error parsing pasted logs: ' + error.message);
            }
        }
        
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'bg-red-500 text-white p-4 rounded-lg mb-6';
            errorDiv.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${escapeHtml(message)}</span>
                    <button class="text-white hover:text-gray-200 text-xl font-bold">&times;</button>
                </div>
            `;
            errorDiv.querySelector('button').addEventListener('click', () => {
                errorDiv.remove();
            });
            dropZone.parentElement.insertBefore(errorDiv, dropZone);
        }

        function loadHistoryFromStorage() {
            try {
                const raw = localStorage.getItem(HISTORY_KEY);
                if (!raw) return [];
                const parsed = JSON.parse(raw);
                return Array.isArray(parsed) ? parsed : [];
            } catch (e) {
                console.warn('Could not read history from localStorage:', e);
                return [];
            }
        }

        function persistHistory() {
            try {
                localStorage.setItem(HISTORY_KEY, JSON.stringify(historyEntries.slice(0, HISTORY_LIMIT)));
            } catch (e) {
                console.warn('Could not save history to localStorage:', e);
            }
            updateHistoryBadge();
        }

        function updateHistoryBadge() {
            if (historyEntries.length) {
                historyCount.textContent = historyEntries.length;
                historyCount.classList.remove('hidden');
            } else {
                historyCount.classList.add('hidden');
            }
        }

        function addHistoryEntry(label, content, logsCount) {
            if (!content) return;
            const entry = {
                id: `${Date.now()}-${Math.random().toString(16).slice(2, 6)}`,
                label: label || 'Saved logs',
                savedAt: new Date().toISOString(),
                logsCount: Number.isFinite(logsCount) ? logsCount : allLogs.length,
                content
            };
            historyEntries = [entry, ...historyEntries].slice(0, HISTORY_LIMIT);
            persistHistory();
        }

        function renderHistoryList() {
            if (!historyEntries.length) {
                historyList.innerHTML = `<p class="text-sm" style="color: var(--text-muted);">No saved sessions yet. Open a log file or paste logs to save them here.</p>`;
                return;
            }
            historyList.innerHTML = '';
            historyEntries.forEach((entry) => {
                const item = document.createElement('div');
                item.className = 'p-3 mb-2 rounded border border-gray-200 hover:border-gray-300 transition flex items-center justify-between gap-3';
                item.style.backgroundColor = 'var(--bg-secondary)';
                item.style.borderColor = 'var(--border-light)';

                const meta = document.createElement('div');
                meta.innerHTML = `
                    <p class="font-semibold" style="color: var(--text-primary);">${escapeHtml(entry.label)}</p>
                    <p class="text-sm" style="color: var(--text-muted);">${formatSavedDate(entry.savedAt)} ¬∑ ${entry.logsCount || 0} log lines</p>
                `;

                const loadBtn = document.createElement('button');
                loadBtn.className = 'modal-btn modal-btn-primary text-sm';
                loadBtn.textContent = 'Load';
                loadBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    loadHistoryEntry(entry);
                });

                item.addEventListener('click', () => loadHistoryEntry(entry));
                item.appendChild(meta);
                item.appendChild(loadBtn);
                historyList.appendChild(item);
            });
        }

        function loadHistoryEntry(entry) {
            closeHistoryModal();
            try {
                parseContent(entry.content);
                showLoadedState(entry.label || 'Saved logs');
                // Move the used entry to the top for recency
                historyEntries = [entry, ...historyEntries.filter((e) => e.id !== entry.id)];
                persistHistory();
            } catch (error) {
                showError('Error loading saved logs: ' + error.message);
            }
        }

        function closeHistoryModal() {
            historyModal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        function formatSavedDate(isoString) {
            const d = new Date(isoString);
            if (isNaN(d.getTime())) return 'Unknown date';
            const pad = (n) => n.toString().padStart(2, '0');
            return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
        }

        function parseContent(content) {
            const firstLine = content.split('\n').find(line => line.trim());
            if (!firstLine) {
                throw new Error('Log file is empty');
            }

            const looksJson = firstLine.trim().startsWith('{') || firstLine.trim().startsWith('[');
            const primary = looksJson ? parseJSONL(content) : parsePlainText(content);
            const fallback = looksJson ? parsePlainText(content) : parseJSONL(content);
            const chosen = primary.logs.length ? primary : fallback;

            if (!chosen.logs.length) {
                throw new Error('No valid log lines found in file');
            }

            allLogs = chosen.logs;
            totalLogs.textContent = allLogs.length;
            if (chosen.failedLines > 0) {
                console.warn(`Parsed ${allLogs.length} logs. Failed to parse ${chosen.failedLines} lines.`);
            }
            updateFilterCounts();
            applyFilters();
            return { logsCount: allLogs.length };
        }

        function parseDurationToSeconds(text) {
            if (typeof text !== 'string') return null;
            const match = text.match(/(?:(\d+)\s+day[s]?,\s*)?(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)/);
            if (!match) return null;
            const days = Number(match[1] || 0);
            const hours = Number(match[2] || 0);
            const minutes = Number(match[3] || 0);
            const seconds = Number(match[4] || 0);
            return days * 86400 + hours * 3600 + minutes * 60 + seconds;
        }

        function getElapsedSeconds(log) {
            const elapsed = log.record?.elapsed;
            if (!elapsed) return null;
            if (typeof elapsed.seconds === 'number') return elapsed.seconds;
            if (elapsed.repr) return parseDurationToSeconds(elapsed.repr);
            return null;
        }

        function getTimestampMs(log) {
            const ts = log.record?.time?.timestamp;
            if (typeof ts === 'number') return ts * 1000;
            const repr = log.record?.time?.repr || log.time?.repr || log.time;
            if (!repr) return null;
            const normalized = repr.includes('T') ? repr : repr.replace(' ', 'T');
            const parsed = Date.parse(normalized);
            if (!Number.isNaN(parsed)) return parsed;
            const fallback = Date.parse(repr);
            return Number.isNaN(fallback) ? null : fallback;
        }

        function sortLogsByTime(logs) {
            if (!Array.isArray(logs) || !logs.length) return [];
            const decorated = logs.map((log, index) => ({
                log,
                index,
                ts: getTimestampMs(log)
            }));

            decorated.sort((a, b) => {
                const aHas = Number.isFinite(a.ts);
                const bHas = Number.isFinite(b.ts);

                if (aHas && bHas) {
                    return sortDirection === 'asc' ? a.ts - b.ts : b.ts - a.ts;
                }
                if (aHas && !bHas) return -1;
                if (!aHas && bHas) return 1;
                return a.index - b.index;
            });

            return decorated.map(item => item.log);
        }

        function formatDuration(seconds) {
            if (!Number.isFinite(seconds)) return 'N/A';
            const totalSeconds = Math.max(0, seconds);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const secs = totalSeconds % 60;
            const parts = [];
            if (hours) parts.push(`${hours}h`);
            if (minutes) parts.push(`${minutes}m`);
            parts.push(`${secs.toFixed(secs >= 10 ? 1 : 3)}s`);
            return parts.join(' ');
        }

        function formatTimestamp(ms) {
            if (!Number.isFinite(ms)) return 'N/A';
            const d = new Date(ms);
            const pad = (n) => n.toString().padStart(2, '0');
            return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ` +
                   `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
        }

        function updateSortToggleLabel() {
            if (!sortToggle) return;
            sortToggle.textContent = sortDirection === 'desc'
                ? 'Sort by Time: Newest ‚Üì'
                : 'Sort by Time: Oldest ‚Üë';
        }

        function updateExecutionStats() {
            if (!filteredLogs.length) {
                statsSection.classList.add('hidden');
                return;
            }

            const timestamps = filteredLogs
                .map(getTimestampMs)
                .filter((value) => Number.isFinite(value))
                .sort((a, b) => a - b);
            const elapsedValues = filteredLogs
                .map(getElapsedSeconds)
                .filter((value) => Number.isFinite(value));

            const gaps = [];
            for (let i = 1; i < timestamps.length; i++) {
                gaps.push((timestamps[i] - timestamps[i - 1]) / 1000);
            }

            const durationFromTimestamps = timestamps.length >= 2
                ? (timestamps[timestamps.length - 1] - timestamps[0]) / 1000
                : null;
            const durationFromElapsed = elapsedValues.length
                ? Math.max(...elapsedValues) - Math.min(...elapsedValues)
                : null;
            const totalDuration = Number.isFinite(durationFromTimestamps) ? durationFromTimestamps : durationFromElapsed;
            const maxElapsed = elapsedValues.length ? Math.max(...elapsedValues) : null;
            const avgGap = gaps.length ? gaps.reduce((sum, val) => sum + val, 0) / gaps.length : null;

            statStartTime.textContent = formatTimestamp(timestamps[0]);
            statEndTime.textContent = formatTimestamp(timestamps[timestamps.length - 1]);
            statTotalDuration.textContent = formatDuration(totalDuration);
            statMaxElapsed.textContent = formatDuration(maxElapsed);
            statAvgGap.textContent = formatDuration(avgGap);

            if (Number.isFinite(durationFromTimestamps)) {
                statsSourceNote.textContent = 'Using log timestamps';
            } else if (elapsedValues.length) {
                statsSourceNote.textContent = 'Using elapsed field';
            } else {
                statsSourceNote.textContent = 'Timing data unavailable';
            }

            statsSection.classList.remove('hidden');
        }

        function parseJSONL(content) {
            const lines = content.split('\n').filter(line => line.trim().length > 0);
            const logs = [];
            let failedLines = 0;
            
            lines.forEach((line, index) => {
                try {
                    const log = JSON.parse(line);
                    logs.push(log);
                } catch (error) {
                    console.error(`Error parsing line ${index + 1}:`, error);
                    failedLines++;
                }
            });

            return { logs, failedLines };
        }

        function parsePlainText(content) {
            const lines = content.split('\n').filter(line => line.trim().length > 0);
            const logs = [];
            let failedLines = 0;
            const levelIcons = {
                DEBUG: 'üêû',
                INFO: '‚ÑπÔ∏è',
                SUCCESS: '‚úÖ',
                WARNING: '‚ö†Ô∏è',
                ERROR: '‚ùå',
                CRITICAL: 'üî•'
            };
            const pattern = /^(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}(?:\.\d+)?)\s*\|\s*([A-Z]+)\s*\|\s*(.+?):([^:]+):(\d+)\s*-\s*(.*)$/;

            lines.forEach((line, index) => {
                const match = line.match(pattern);
                if (!match) {
                    console.error(`Error parsing line ${index + 1}: does not match expected text format`);
                    failedLines++;
                    return;
                }

                const [, timestamp, levelRaw, module, func, lineNo, message] = match;
                const level = levelRaw.trim();

                logs.push({
                    time: { repr: timestamp },
                    record: {
                        level: { name: level, icon: levelIcons[level] || '‚ùì' },
                        module: module.trim(),
                        function: func.trim(),
                        line: Number(lineNo),
                        message: message.trim()
                    },
                    text: line
                });
            });

            return { logs, failedLines };
        }

        function updateFilterCounts() {
            const counts = {
                ALL: allLogs.length,
                DEBUG: 0,
                INFO: 0,
                SUCCESS: 0,
                WARNING: 0,
                ERROR: 0,
                CRITICAL: 0
            };
            
            allLogs.forEach(log => {
                const level = log.record?.level?.name || 'UNKNOWN';
                if (counts[level] !== undefined) {
                    counts[level]++;
                }
            });
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                const level = btn.getAttribute('data-level');
                const countSpan = btn.querySelector('.count');
                if (countSpan) {
                    countSpan.textContent = counts[level] || 0;
                }
            });
        }

        function applyFilters() {
            filteredLogs = allLogs.filter(log => {
                const level = log.record?.level?.name || 'UNKNOWN';
                const matchesLevel = currentFilter === 'ALL' || level === currentFilter;
                
                if (!matchesLevel) return false;
                
                if (searchTerm) {
                    const message = log.record?.message?.toLowerCase() || '';
                    const module = log.record?.module?.toLowerCase() || '';
                    const func = log.record?.function?.toLowerCase() || '';
                    const text = log.text?.toLowerCase() || '';
                    
                    return message.includes(searchTerm) || 
                           module.includes(searchTerm) || 
                           func.includes(searchTerm) ||
                           text.includes(searchTerm);
                }
                
                return true;
            });
            
            filteredLogs = sortLogsByTime(filteredLogs);
            renderTable();
            updateExecutionStats();
            if (copyModeEnabled) {
                updateCopyPanel();
            }
        }

        function renderTable() {
            logTableBody.innerHTML = '';
            
            if (filteredLogs.length === 0) {
                noResults.classList.remove('hidden');
                return;
            }
            
            noResults.classList.add('hidden');
            
            filteredLogs.forEach(log => {
                const record = log.record || {};
                const level = record.level?.name || 'UNKNOWN';
                const icon = record.level?.icon || '‚ùì';
                const time = record.time?.repr || 'N/A';
                const module = record.module || 'N/A';
                const func = record.function || 'N/A';
                const line = record.line || 'N/A';
                const message = record.message || log.text || 'N/A';
                
                // Format timestamp by removing timezone if present
                const formattedTime = time.includes('+') ? time.split('+')[0] : 
                                     time.includes('T') ? time.split('.')[0].replace('T', ' ') : 
                                     time;
                
                const row = document.createElement('tr');
                row.className = 'log-row';
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm text-gray-700 whitespace-nowrap">${escapeHtml(formattedTime)}</td>
                    <td class="px-4 py-3 text-sm whitespace-nowrap">
                        <span class="level-${level} font-semibold">${icon} ${level}</span>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-700">${escapeHtml(module)}</td>
                    <td class="px-4 py-3 text-sm text-gray-700">${escapeHtml(func)}</td>
                    <td class="px-4 py-3 text-sm text-gray-700">${line}</td>
                    <td class="px-4 py-3 text-sm text-gray-800">${escapeHtml(message)}</td>
                `;
                
                // Add click handler to show full log details
                row.addEventListener('click', () => showLogDetails(log));
                row.style.cursor = 'pointer';
                
                logTableBody.appendChild(row);
            });
        }

        function showLogDetails(log) {
            const details = JSON.stringify(log, null, 2);
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
            modal.innerHTML = `
                <div class="rounded-lg max-w-4xl w-full max-h-[80vh] overflow-hidden" style="background-color: var(--modal-bg);">
                    <div class="p-4 border-b flex justify-between items-center" style="border-color: var(--border-light);">
                        <h3 class="text-lg font-semibold" style="color: var(--text-primary);">Log Details</h3>
                        <button class="text-2xl" style="color: var(--text-muted);">&times;</button>
                    </div>
                    <div class="p-4 overflow-auto max-h-[calc(80vh-60px)]">
                        <pre class="p-4 rounded text-sm overflow-x-auto" style="background-color: var(--bg-gray-100); color: var(--text-primary);">${escapeHtml(details)}</pre>
                    </div>
                </div>
            `;
            
            modal.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
            
            document.body.appendChild(modal);
        }

        function escapeHtml(text) {
            if (text === null || text === undefined) return '';
            const div = document.createElement('div');
            div.textContent = String(text);
            return div.innerHTML;
        }

        function setCopyMode(enabled) {
            copyModeEnabled = enabled;
            if (enabled) {
                copyPanel.classList.remove('hidden');
                copyModeToggle.textContent = 'Copy Mode: On';
                updateCopyPanel();
                requestAnimationFrame(() => {
                    copyTextArea.focus();
                    copyTextArea.select();
                });
            } else {
                copyPanel.classList.add('hidden');
                copyModeToggle.textContent = 'Copy & Paste Mode';
            }
        }

        function updateCopyPanel() {
            if (!copyModeEnabled) return;
            const content = filteredLogs.map(formatLogForCopy).join('\n');
            copyTextArea.value = content || 'No logs match the current filter.';
        }

        function formatLogForCopy(log) {
            if (log.text) return log.text;
            const level = log.record?.level?.name || 'UNKNOWN';
            const module = log.record?.module || 'N/A';
            const func = log.record?.function || 'N/A';
            const line = log.record?.line ?? 'N/A';
            const message = log.record?.message || '';
            const time = log.time?.repr || log.record?.time?.repr || '';
            return `${time} | ${level} | ${module}:${func}:${line} - ${message}`.trim();
        }

        // Add active state styling for filter buttons
        const style = document.createElement('style');
        style.textContent = `
            .filter-btn {
                padding: 0.5rem 1rem;
                border-radius: 0.5rem;
                background-color: var(--bg-tertiary);
                border: 2px solid var(--border-card);
                transition: all 0.2s ease;
                cursor: pointer;
                color: var(--text-secondary);
            }
            .filter-btn:hover {
                background-color: var(--hover-bg);
                border-color: var(--border-color);
            }
            .filter-btn.active {
                background-color: #4299e1;
                color: white;
                border-color: #3182ce;
            }
            .filter-btn.active .count {
                background-color: rgba(255, 255, 255, 0.3);
                color: white;
            }
            .filter-btn .count {
                color: var(--text-tertiary);
            }
            
            /* Responsive Filter Section */
            @media (max-width: 768px) {
                .filter-btn {
                    padding: 0.4rem 0.75rem;
                    font-size: 0.875rem;
                }
                .filter-btn .count {
                    font-size: 0.75rem;
                    padding: 0.1rem 0.4rem;
                }
            }
            
            @media (max-width: 640px) {
                .filter-btn {
                    padding: 0.35rem 0.6rem;
                    font-size: 0.8125rem;
                    white-space: nowrap;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
